<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Calculate marginal expected response for specified exposure values — sim_er_new_exp_marg • BayesERtools</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Calculate marginal expected response for specified exposure values — sim_er_new_exp_marg"><meta name="description" content='Responses at specified exposure values are calculated for n_subj_sim
subjects with different covariates (sampled from newdata),
and the predicted responses are "marginalized" (averaged),
resulting in marginal expected response on the
population of interest.'><meta property="og:description" content='Responses at specified exposure values are calculated for n_subj_sim
subjects with different covariates (sampled from newdata),
and the predicted responses are "marginalized" (averaged),
resulting in marginal expected response on the
population of interest.'><meta property="og:image" content="https://genentech.github.io/BayesERtools/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">BayesERtools</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.1.1001</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://genentech.github.io/BayesERbook/">BayesERbook</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/overview_of_the_package.html">0. Overview of the package</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><a class="external-link nav-link" href="https://github.com/genentech/BayesERtools" aria-label="Github project page"><span class="fa fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Calculate marginal expected response for specified exposure values</h1>

      <div class="d-none name"><code>sim_er_new_exp_marg.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Responses at specified exposure values are calculated for <code>n_subj_sim</code>
subjects with different covariates (sampled from <code>newdata</code>),
and the predicted responses are "marginalized" (averaged),
resulting in marginal expected response on the
population of interest.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">sim_er_new_exp_marg</span><span class="op">(</span></span>
<span>  <span class="va">ermod</span>,</span>
<span>  exposure_to_sim_vec <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  data_cov <span class="op">=</span> <span class="fu"><a href="extract_method.html">extract_data</a></span><span class="op">(</span><span class="va">ermod</span><span class="op">)</span>,</span>
<span>  n_subj_sim <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  n_draws_sim <span class="op">=</span> <span class="fl">500</span>,</span>
<span>  seed_sample_draws <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  output_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"draws"</span>, <span class="st">"median_qi"</span><span class="op">)</span>,</span>
<span>  qi_width <span class="op">=</span> <span class="fl">0.95</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">sim_er_curve_marg</span><span class="op">(</span></span>
<span>  <span class="va">ermod</span>,</span>
<span>  exposure_range <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  num_exposures <span class="op">=</span> <span class="fl">51</span>,</span>
<span>  data_cov <span class="op">=</span> <span class="fu"><a href="extract_method.html">extract_data</a></span><span class="op">(</span><span class="va">ermod</span><span class="op">)</span>,</span>
<span>  n_subj_sim <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  n_draws_sim <span class="op">=</span> <span class="fl">500</span>,</span>
<span>  seed_sample_draws <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  output_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"draws"</span>, <span class="st">"median_qi"</span><span class="op">)</span>,</span>
<span>  qi_width <span class="op">=</span> <span class="fl">0.95</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-ermod">ermod<a class="anchor" aria-label="anchor" href="#arg-ermod"></a></dt>
<dd><p>An object of class <code>ermod</code></p></dd>


<dt id="arg-exposure-to-sim-vec">exposure_to_sim_vec<a class="anchor" aria-label="anchor" href="#arg-exposure-to-sim-vec"></a></dt>
<dd><p>Vector of exposure values to simulate.</p></dd>


<dt id="arg-data-cov">data_cov<a class="anchor" aria-label="anchor" href="#arg-data-cov"></a></dt>
<dd><p>Data frame containing covariates to use for simulation.
Different from <code><a href="sim_er_new_exp.html">sim_er_new_exp()</a></code>, <code>data_cov</code> can be large as long as
<code>n_subj_sim</code> is set to a reasonable number. Default is set to
<code>extract_data(ermod)</code> which is the full data used to fit the model.</p></dd>


<dt id="arg-n-subj-sim">n_subj_sim<a class="anchor" aria-label="anchor" href="#arg-n-subj-sim"></a></dt>
<dd><p>Maximum number of subjects to simulate. Default of 100
should be sufficient in many cases, as it's only used for marginal
response calculation.
Set to NULL to use all subjects in <code>data_cov</code> without resampling;
in this case, be mindful of the computation time.</p></dd>


<dt id="arg-n-draws-sim">n_draws_sim<a class="anchor" aria-label="anchor" href="#arg-n-draws-sim"></a></dt>
<dd><p>Number of draws for simulation. Default is set to 500
to reduce computation time for marginal response calculation.</p></dd>


<dt id="arg-seed-sample-draws">seed_sample_draws<a class="anchor" aria-label="anchor" href="#arg-seed-sample-draws"></a></dt>
<dd><p>Seed for sampling draws. Default is NULL.</p></dd>


<dt id="arg-output-type">output_type<a class="anchor" aria-label="anchor" href="#arg-output-type"></a></dt>
<dd><p>Type of output. "draws" returns the raw draws from the
simulation, and "median_qi" returns the median and quantile interval.</p></dd>


<dt id="arg-qi-width">qi_width<a class="anchor" aria-label="anchor" href="#arg-qi-width"></a></dt>
<dd><p>Width of the quantile interval. Default is 0.95. Only
used when <code>output_type = "median_qi"</code>.</p></dd>


<dt id="arg-exposure-range">exposure_range<a class="anchor" aria-label="anchor" href="#arg-exposure-range"></a></dt>
<dd><p>Range of exposure values to simulate. If NULL
(default), it is set to the range of the exposure variable in the original
data for model development.</p></dd>


<dt id="arg-num-exposures">num_exposures<a class="anchor" aria-label="anchor" href="#arg-num-exposures"></a></dt>
<dd><p>Number of exposure values to simulate.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p><code>ersim_marg</code> object, which is a tibble with the simulated marginal
expected response with some additional information in object attributes.
In case of <code>output_type = "median_qi"</code>, it returns <code>ersim_marg_med_qi</code>
object.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p><code>sim_er_new_exp_marg()</code> returns a tibble with the marginal expected
response for each exposure value in <code>exposure_to_sim_vec</code>.</p>
<p><code>sim_er_curve_marg()</code> is a wrapper function for <code>sim_er_new_exp_marg()</code>
that use a range of exposure values to simulate the marginal expected
responses. Particularly useful for plotting the exposure-response curve.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="calc_ersim_med_qi.html">calc_ersim_med_qi()</a></code> for calculating median and quantile interval
from <code>ersim_marg</code> object (generated with <code>output_type = "draws"</code>).</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">d_sim_binom_cov_hgly2</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">ermod_bin</span> <span class="op">&lt;-</span> <span class="fu"><a href="dev_ermod_bin.html">dev_ermod_bin</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  data <span class="op">=</span> <span class="va">d_sim_binom_cov_hgly2</span>,</span></span>
<span class="r-in"><span>  var_resp <span class="op">=</span> <span class="st">"AEFLAG"</span>,</span></span>
<span class="r-in"><span>  var_exposure <span class="op">=</span> <span class="st">"AUCss_1000"</span>,</span></span>
<span class="r-in"><span>  var_cov <span class="op">=</span> <span class="st">"BHBA1C_5"</span>,</span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">ersim_new_exp_marg_med_qi</span> <span class="op">&lt;-</span> <span class="fu">sim_er_new_exp_marg</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">ermod_bin</span>,</span></span>
<span class="r-in"><span>  exposure_to_sim_vec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">6</span>, by <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  data_cov <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>BHBA1C_5 <span class="op">=</span> <span class="fl">4</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  n_subj_sim <span class="op">=</span> <span class="cn">NULL</span>,</span></span>
<span class="r-in"><span>  n_draws_sim <span class="op">=</span> <span class="fl">500</span>, <span class="co"># This is set to make the example run faster</span></span></span>
<span class="r-in"><span>  output_type <span class="op">=</span> <span class="st">"median_qi"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">ersim_new_exp_marg_med_qi</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 21 × 14</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    .id_exposure AUCss_1000 .epred .epred.lower .epred.upper .linpred</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 1</span>            1        2    0.171        0.142        0.203    -<span style="color: #BB0000;">1.98</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 2</span>            2        2.2  0.182        0.154        0.214    -<span style="color: #BB0000;">1.89</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 3</span>            3        2.4  0.194        0.164        0.226    -<span style="color: #BB0000;">1.81</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 4</span>            4        2.6  0.206        0.175        0.238    -<span style="color: #BB0000;">1.71</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 5</span>            5        2.8  0.219        0.186        0.253    -<span style="color: #BB0000;">1.62</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 6</span>            6        3    0.232        0.199        0.269    -<span style="color: #BB0000;">1.54</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 7</span>            7        3.2  0.245        0.211        0.284    -<span style="color: #BB0000;">1.45</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 8</span>            8        3.4  0.260        0.222        0.301    -<span style="color: #BB0000;">1.35</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 9</span>            9        3.6  0.273        0.233        0.320    -<span style="color: #BB0000;">1.27</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">10</span>           10        3.8  0.288        0.243        0.339    -<span style="color: #BB0000;">1.18</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># ℹ 11 more rows</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># ℹ 8 more variables: .linpred.lower &lt;dbl&gt;, .linpred.upper &lt;dbl&gt;,</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;">#   .prediction &lt;dbl&gt;, .prediction.lower &lt;dbl&gt;, .prediction.upper &lt;dbl&gt;,</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;">#   .width &lt;dbl&gt;, .point &lt;chr&gt;, .interval &lt;chr&gt;</span></span>
<span class="r-in"><span><span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Kenta Yoshida, François Mercier.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

